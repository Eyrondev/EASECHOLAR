<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - EASECHOLAR</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        },
                        secondary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    fontFamily: {
                        'sans': ['Inter', 'ui-sans-serif', 'system-ui'],
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Mobile Responsive Styles -->
    <link rel="stylesheet" href="/Assets/css/mobile-responsive.css">

</head>
<body class="bg-gray-50 font-sans">
    <!-- Sidebar component (fixed) -->
    <div id="sidebar-container"></div>
    
    <!-- Navigation component (fixed) -->
    <div id="nav-container"></div>

    <!-- Main content with proper spacing for fixed sidebar and nav -->
    <div class="ml-64 pt-16">
        <div class="p-8">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Settings</h1>
                <p class="mt-2 text-gray-600">Manage your organization preferences and account settings</p>
            </div>

            <!-- Settings Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Settings Navigation -->
                <div class="lg:col-span-1">
                    <nav class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
                        <ul class="space-y-2">
                            <li>
                                <button onclick="showSection('organization')" id="org-tab" class="w-full text-left px-4 py-3 rounded-lg bg-green-50 text-green-700 font-medium">
                                    <i class="fas fa-building w-4 h-4 mr-3"></i>
                                    Organization Profile
                                </button>
                            </li>
                            <li>
                                <button onclick="showSection('security')" id="security-tab" class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                                    <i class="fas fa-shield-alt w-4 h-4 mr-3"></i>
                                    Security
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- Settings Content -->
                <div class="lg:col-span-2">
                    <!-- Organization Profile Section -->
                    <div id="organization-section" class="settings-section">
                        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
                            <h2 class="text-xl font-semibold text-gray-900 mb-6">Organization Profile</h2>
                            
                            <form class="space-y-6" onsubmit="saveProfile(event)">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Organization Name</label>
                                        <input type="text" id="org-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Organization Type</label>
                                        <select id="org-type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                            <option value="">Select Type</option>
                                            <option value="Non-Profit">Non-Profit</option>
                                            <option value="Foundation">Foundation</option>
                                            <option value="Corporate">Corporate</option>
                                            <option value="Government">Government</option>
                                            <option value="Educational Institution">Educational Institution</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                        <input type="text" id="first-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                        <input type="text" id="last-name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                        <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500 bg-gray-50" readonly>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Contact Title</label>
                                        <input type="text" id="contact-title" placeholder="e.g., Director, Manager" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                                    <textarea rows="2" id="address" placeholder="Street address" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"></textarea>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                        <input type="text" id="city" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">State/Province</label>
                                        <input type="text" id="state" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Zip Code</label>
                                        <input type="text" id="zip-code" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Organization Description</label>
                                    <textarea rows="4" id="description" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                    <input type="url" id="website" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500">
                                </div>
                                
                                <div class="flex justify-end">
                                    <button type="submit" class="px-6 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                        Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Security Section -->
                    <div id="security-section" class="settings-section hidden">
                        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
                            <h2 class="text-xl font-semibold text-gray-900 mb-6">Security Settings</h2>
                            
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Change Password</h3>
                                    <form class="space-y-4" onsubmit="changePassword(event)">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                                            <input type="password" id="current-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                                            <input type="password" id="new-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required minlength="6">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                                            <input type="password" id="confirm-password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-green-500 focus:border-green-500" required minlength="6">
                                        </div>
                                        <button type="submit" class="px-4 py-2 bg-green-600 text-white font-medium rounded-md hover:bg-green-700">
                                            Update Password
                                        </button>
                                    </form>
                                </div>
                                
                                <div class="border-t pt-6">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Login Sessions</h3>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                            <div>
                                                <p class="font-medium text-gray-900">Current Session</p>
                                                <p class="text-sm text-gray-600">Windows • Chrome • Philippines</p>
                                            </div>
                                            <span class="text-sm text-green-600">Active now</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Component Loader Script -->
    <script src="components.js"></script>

    <!-- Page Scripts -->
    <script>
        let profileData = null;

        // Load profile data
        async function loadProfile() {
            try {
                const response = await fetch('/api/provider/profile');
                const data = await response.json();
                
                if (data.success) {
                    profileData = data.profile;
                    populateProfileForm();
                } else {
                    showNotification('Failed to load profile', 'error');
                }
            } catch (error) {
                console.error('Error loading profile:', error);
                showNotification('Error loading profile data', 'error');
            }
        }

        // Populate profile form with data
        function populateProfileForm() {
            document.getElementById('org-name').value = profileData.organization_name || '';
            document.getElementById('org-type').value = profileData.organization_type || '';
            document.getElementById('email').value = profileData.email || '';
            document.getElementById('phone').value = profileData.phone_number || '';
            document.getElementById('first-name').value = profileData.first_name || '';
            document.getElementById('last-name').value = profileData.last_name || '';
            document.getElementById('contact-title').value = profileData.contact_title || '';
            document.getElementById('address').value = profileData.address || '';
            document.getElementById('city').value = profileData.city || '';
            document.getElementById('state').value = profileData.state || '';
            document.getElementById('zip-code').value = profileData.zip_code || '';
            document.getElementById('description').value = profileData.description || '';
            document.getElementById('website').value = profileData.website || '';
        }

        // Save profile changes
        async function saveProfile(event) {
            event.preventDefault();
            
            const formData = {
                organization_name: document.getElementById('org-name').value,
                organization_type: document.getElementById('org-type').value,
                first_name: document.getElementById('first-name').value,
                last_name: document.getElementById('last-name').value,
                phone_number: document.getElementById('phone').value,
                contact_person: `${document.getElementById('first-name').value} ${document.getElementById('last-name').value}`,
                contact_title: document.getElementById('contact-title').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip_code: document.getElementById('zip-code').value,
                description: document.getElementById('description').value,
                website: document.getElementById('website').value
            };

            try {
                const response = await fetch('/api/provider/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (data.success) {
                    showNotification('Profile updated successfully', 'success');
                    loadProfile(); // Reload profile data
                } else {
                    showNotification(data.message || 'Failed to update profile', 'error');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Error updating profile', 'error');
            }
        }

        // Change password
        async function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            // Validate passwords
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Please fill in all password fields', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showNotification('New password must be at least 6 characters', 'error');
                return;
            }

            // TODO: Implement password change endpoint
            showNotification('Password change feature coming soon', 'info');
            event.target.reset();
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 px-6 py-3 rounded-lg shadow-lg text-white z-50 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                'bg-blue-600'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }

        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.settings-section');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Remove active class from all tabs
            const tabs = ['org-tab', 'security-tab'];
            tabs.forEach(tab => {
                const element = document.getElementById(tab);
                element.classList.remove('bg-green-50', 'text-green-700');
                element.classList.add('text-gray-700', 'hover:bg-gray-50');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Add active class to selected tab
            const activeTab = sectionName === 'organization' ? 'org-tab' : 'security-tab';
            
            const activeElement = document.getElementById(activeTab);
            activeElement.classList.add('bg-green-50', 'text-green-700');
            activeElement.classList.remove('text-gray-700', 'hover:bg-gray-50');
        }

        // Load profile on page load
        document.addEventListener('DOMContentLoaded', loadProfile);
    </script>

    <!-- Mobile Menu Handler -->
    <script src="/Assets/js/mobile-menu.js"></script>
</body>
</html>